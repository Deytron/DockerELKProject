version: "3.9"

services:
  traefik:
    image: traefik:latest
    container_name: traefik
    command:
      - --api.insecure=true
      - --providers.docker=true
      - --entrypoints.web.address=:80
    ports:
      - 80:80
      - 8080:8080
      - 443:443
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./letsencrypt:/letsencrypt
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.myrouter.entrypoints=web"
      - "traefik.http.services.myservice.loadbalancer.server.port=80"
    restart: unless-stopped
  ##########################
  jellyfin:
    image: linuxserver/jellyfin:latest
    container_name: jellyfin
    # user: 968:968
    restart: unless-stopped
    volumes:
      - ./jellyfin/config:/config
      - movies:/movies
      - series:/series
      - anime:/anime
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.jellyfin.rule=Host(`stream.localhost`)"
      - "traefik.http.routers.jellyfin.entrypoints=web"
      - "traefik.http.services.jellyfin.loadbalancer.server.port=8096"
    devices:
      - /dev/dri/renderD128:/dev/dri/renderD128
      - /dev/dri/card0:/dev/dri/card0
  ############################
  # Download stack
  ############################
  prowlarr:
    image: linuxserver/prowlarr
    container_name: prowlarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/New_York
    volumes:
      - ./prowlarr/config:/config
      - ./prowlarr/downloads:/downloads
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.prowlarr.rule=Host(`prowlarr.localhost`)"
      - "traefik.http.routers.prowlarr.entrypoints=web"
      - "traefik.http.services.prowlarr.loadbalancer.server.port=9696"

  ############################
  sonarr:
    image: linuxserver/sonarr
    container_name: sonarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/New_York
    volumes:
      - ./sonarr/config:/config
      - series:/series
      - anime:/anime
      - all-downloads:/downloads
    ports:
      - 8989:8989
    depends_on:
      - prowlarr
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.sonarr.rule=Host(`sonarr.localhost`)"
      - "traefik.http.routers.sonarr.entrypoints=web"
      - "traefik.http.services.sonarr.loadbalancer.server.port=8989"

  ############################
  radarr:
    image: linuxserver/radarr
    container_name: radarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/New_York
    volumes:
      - ./radarr/config:/config
      - movies:/movies
      - all-downloads:/downloads
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.radarr.rule=Host(`radarr.localhost`)"
      - "traefik.http.routers.radarr.entrypoints=web"
      - "traefik.http.services.radarr.loadbalancer.server.port=7878"
    depends_on:
      - prowlarr
    restart: unless-stopped

  ############################
  lidarr:
    image: linuxserver/lidarr
    container_name: lidarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/New_York
    volumes:
      - ./lidarr/config:/config
      - ./lidarr/downloads:/downloads
      - ./lidarr/music:/music
      - all-downloads:/downloads
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.lidarr.rule=Host(`lidarr.localhost`)"
      - "traefik.http.routers.lidarr.entrypoints=web"
      - "traefik.http.services.lidarr.loadbalancer.server.port=8686"
    depends_on:
      - prowlarr
    restart: unless-stopped

  #############################
  transmission:
    image: linuxserver/transmission
    container_name: transmission
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/New_York
      - USER=user
      - PASSWORD=password
    volumes:
      - ./transmission/config:/config
      - ./transmission/torrents:/torrents
      - all-downloads:/downloads
    ports:
      - 9091:9091
      - 51413:51413
      - 51413:51413/udp
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.transmission.rule=Host(`transmission.localhost`)"
      - "traefik.http.routers.transmission.entrypoints=web"
      - "traefik.http.services.transmission.loadbalancer.server.port=9091"

  ############################
  # showdown:
  #   image: voidmonkey/pokemon-showdown
  #   container_name: showdown
  #   environment:
  #     - PUID=1000
  #     - PGID=1000
  #     - TZ=America/New_York
  #   labels:
  #     - "traefik.enable=true"
  #     - "traefik.http.routers.showdown.rule=Host(`showdown.localhost`)"
  #     - "traefik.http.routers.showdown.entrypoints=web"
  #     - "traefik.http.services.showdown.loadbalancer.server.port=8000"
  #   depends_on:
  #     - prowlarr
  #   restart: unless-stopped

volumes:
  all-downloads:
  anime:
  series:
  movies:
